<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Vue.js Form</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
</head>
<body>

<div id="app">
    <h1>Vue Test</h1>
    <form @submit.prevent="submitForm">
        <div>
            <label for="input1">User ID:</label>
            <input type="text" id="input2" v-model="inputs.inputUserID">
        </div>
        <div>
            <label for="input2">Keywords:</label>
            <input type="text" id="input3" v-model="inputs.inputKeywords">
        </div>
        <div>
            <label for="input3">Description:</label>
            <input type="text" id="input4" v-model="inputs.inputDescription">
        </div>
        <div>
            <label for="input4">Image:</label>
            <input type="text" id="input5" v-model="inputs.inputImage">
        </div>
        <div>
            <label for="input5">Latitude:</label>
            <input type="text" id="input6" v-model="inputs.inputLat">
        </div>
        <div>
            <label for="input6">Longitude:</label>
            <input type="text" id="input7" v-model="inputs.inputLon">
        </div>
        <button type="submit" @click="GetAll">Get Data</button>
        <button type="submit" @click="PostItem">Add Item</button>
    </form>
    <div id="container">
    </div>
</div>

<script>
    new Vue({
        el: '#app',
        data: {
            inputs: {
                inputUserID: '',
                inputKeywords: '',
                inputDescription: '',
                inputImage: '',
                inputLat: '',
                inputLon: ''
            },
            responseData: null
        },
        
        methods: {
            GetAll() {
                const urlParams = new URLSearchParams(window.location.search)
                const serverURL = (urlParams.get('api') || '').replace(/\/$/, '')

                if (serverURL) {
                    axios.get(`${serverURL}/items`)
                    .then(response => {
                        this.responseData = response.data
                        const container = document.getElementById('container')

                        this.responseData.forEach(item => {
                            const div = document.createElement('div')
                            div.textContent = `User ID: ${item.user_id}, Description: ${item.description}`

                            const image = document.createElement('img')
                            image.src = item.image
                            image.alt = 'Image of a Cat'

                            const removeButton = document.createElement('button')
                            removeButton.textContent = 'Remove'
                            removeButton.addEventListener('click', () => {
                                container.removeChild(div)
                            })

                            div.appendChild(image)
                            div.appendChild(removeButton)
                            container.appendChild(div)
                        })

                    })
                    .catch(error => {
                        console.error(error)
                    })
                } else {
                    console.error('Server URL is not specified')
                }
                
            },

            PostItem() {
                const urlParams = new URLSearchParams(window.location.search)
                const serverURL = (urlParams.get('api') || '').replace(/\/$/, '')

                if (serverURL) {
                    const inputData = {
                        user_id: this.inputs.inputUserID,
                        keywords: this.inputs.inputKeywords,
                        description: this.inputs.inputDescription,
                        image: this.inputs.inputImage,
                        lat: this.inputs.inputLat,
                        lon: this.inputs.inputLon
                    };

                    axios.post(`${serverURL}/item`, inputData)

                    .then(response => {
                        const container = document.getElementById('container')
                        const div = document.getElementById('div')
                        div.textContent = `User ID: ${response.data.user_id}, Description: ${response.data.description}`

                        const image = document.createElement('img')
                        image.src = response.data.image
                        image.alt = 'Image of a Cat'

                        const removeButton = document.createElement('button')
                        removeButton.textContent = 'Remove'
                        removeButton.addEventListener('click', () => {
                            container.removeChild(div)
                        })

                        div.appendChild(image)
                        div.appendChild(removeButton)
                        container.appendChild(div)

                    })
                    .catch(error => {
                        console.error(error)
                    })
                } else {
                    console.error('Server URL is not Specified')
                }
            }
        }
    })
</script>

</body>
</html>
